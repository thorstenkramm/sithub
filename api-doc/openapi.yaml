openapi: 3.1.0
info:
  title: SitHub API
  version: 0.1.0
  license:
    name: Proprietary
    url: https://example.com/license
servers:
  - url: /api/v1
security:
  - cookieAuth: []
paths:
  /ping:
    $ref: ./endpoints/ping.yaml
  /areas:
    $ref: ./endpoints/areas.yaml
  /areas/{area_id}/item-groups:
    $ref: ./endpoints/item-groups.yaml
  /areas/{area_id}/item-groups/availability:
    $ref: ./endpoints/item-group-availability.yaml
  /areas/{area_id}/presence:
    $ref: ./endpoints/area-presence.yaml
  /item-groups/{item_group_id}/items:
    $ref: ./endpoints/items.yaml
  /item-groups/{item_group_id}/bookings:
    $ref: ./endpoints/item-group-bookings.yaml
  /bookings:
    $ref: ./endpoints/bookings.yaml
  /bookings/history:
    $ref: ./endpoints/bookings-history.yaml
  /bookings/{booking_id}:
    $ref: ./endpoints/booking.yaml
  /me:
    $ref: ./endpoints/me.yaml
  /auth/login:
    $ref: ./endpoints/auth-login.yaml
  /auth/logout:
    $ref: ./endpoints/auth-logout.yaml
  /users:
    $ref: ./endpoints/users.yaml
  /users/{user_id}:
    $ref: ./endpoints/user.yaml

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: sithub_user
  schemas:
    ErrorResponse:
      type: object
      properties:
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ErrorObject'
      required:
        - errors
    ErrorObject:
      type: object
      properties:
        status:
          type: string
        title:
          type: string
        detail:
          type: string
        code:
          type: string
    Resource:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        attributes:
          type: object
    SingleResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/Resource'
      required:
        - data
    CollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Resource'
      required:
        - data
    AreaAttributes:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        floor_plan:
          type: string
      required:
        - name
    AreaResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: areas
            attributes:
              $ref: '#/components/schemas/AreaAttributes'
          required:
            - type
            - attributes
    AreaCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AreaResource'
      required:
        - data
    ItemGroupAttributes:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        floor_plan:
          type: string
      required:
        - name
    ItemGroupResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: item-groups
            attributes:
              $ref: '#/components/schemas/ItemGroupAttributes'
          required:
            - type
            - attributes
    ItemGroupCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ItemGroupResource'
      required:
        - data
    ItemAttributes:
      type: object
      properties:
        name:
          type: string
        equipment:
          type: array
          items:
            type: string
        availability:
          type: string
          enum:
            - available
            - occupied
        warning:
          type: string
        booking_id:
          type: string
          description: Booking ID (admin only, present when occupied)
        booker_name:
          type: string
          description: Name of user who booked (present when occupied)
        note:
          type: string
          description: Booking note (present when occupied and note is not empty)
      required:
        - name
        - equipment
        - availability
    ItemResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: items
            attributes:
              $ref: '#/components/schemas/ItemAttributes'
          required:
            - type
            - attributes
    ItemCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ItemResource'
      required:
        - data
    CreateBookingRequestAttributes:
      type: object
      properties:
        item_id:
          type: string
          description: ID of the item to book
        booking_date:
          type: string
          format: date
          description: Date to book the item (YYYY-MM-DD), for single-day bookings
        booking_dates:
          type: array
          items:
            type: string
            format: date
          description: >
            Array of dates to book (YYYY-MM-DD), for multi-day bookings.
            Use either booking_date or booking_dates, not both.
        for_user_id:
          type: string
          description: >
            Optional. ID of another user to book on behalf of.
            The user must exist in the system.
        for_user_name:
          type: string
          description: >
            Optional. Display name for the booking target.
            Required for guest bookings (when is_guest is true).
        is_guest:
          type: boolean
          description: >
            Optional. Set to true to create a guest booking.
            Requires for_user_name.
        guest_email:
          type: string
          format: email
          description: Optional contact email for guest bookings.
      required:
        - item_id
    CreateBookingRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            type:
              type: string
              const: bookings
            attributes:
              $ref: '#/components/schemas/CreateBookingRequestAttributes'
          required:
            - type
            - attributes
      required:
        - data
    BookingAttributes:
      type: object
      properties:
        item_id:
          type: string
        user_id:
          type: string
        booking_date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
        note:
          type: string
          description: Free-text note attached to the booking (max 500 characters)
        booked_by_user_id:
          type: string
          description: ID of the user who created the booking (present when different from user_id)
        is_guest:
          type: boolean
          description: Whether this is a guest booking
        guest_email:
          type: string
          description: Contact email for guest bookings
      required:
        - item_id
        - user_id
        - booking_date
        - created_at
        - note
    BookingResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: bookings
            attributes:
              $ref: '#/components/schemas/BookingAttributes'
          required:
            - type
            - attributes
    BookingSingleResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/BookingResource'
      required:
        - data
    MyBookingAttributes:
      type: object
      properties:
        item_id:
          type: string
        item_name:
          type: string
        item_group_id:
          type: string
        item_group_name:
          type: string
        area_id:
          type: string
        area_name:
          type: string
        booking_date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
        note:
          type: string
          description: Free-text note attached to the booking (max 500 characters)
        booked_by_user_id:
          type: string
          description: ID of the user who made the booking (empty if self-booked)
        booked_by_user_name:
          type: string
          description: Name of the user who made the booking (empty if self-booked)
        booked_for_me:
          type: boolean
          description: >
            True if this booking was made on behalf of the current user
            by someone else. False for self-bookings or bookings the
            current user made for others.
        is_guest:
          type: boolean
          description: Whether this is a guest booking
        guest_email:
          type: string
          description: Contact email for guest bookings
      required:
        - item_id
        - item_name
        - item_group_id
        - item_group_name
        - area_id
        - area_name
        - booking_date
        - created_at
        - note
        - booked_by_user_id
        - booked_by_user_name
        - booked_for_me
    MyBookingResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: bookings
            attributes:
              $ref: '#/components/schemas/MyBookingAttributes'
          required:
            - type
            - attributes
    MyBookingsCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/MyBookingResource'
      required:
        - data
    ItemGroupBookingAttributes:
      type: object
      properties:
        item_id:
          type: string
        item_name:
          type: string
        user_id:
          type: string
        user_name:
          type: string
        booking_date:
          type: string
          format: date
        note:
          type: string
          description: Free-text note attached to the booking
      required:
        - item_id
        - item_name
        - user_id
        - user_name
        - booking_date
        - note
    ItemGroupBookingResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: bookings
            attributes:
              $ref: '#/components/schemas/ItemGroupBookingAttributes'
          required:
            - type
            - attributes
    ItemGroupBookingsCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ItemGroupBookingResource'
      required:
        - data
    AreaPresenceAttributes:
      type: object
      properties:
        user_id:
          type: string
        user_name:
          type: string
        item_id:
          type: string
        item_name:
          type: string
        item_group_id:
          type: string
        item_group_name:
          type: string
        note:
          type: string
          description: Free-text note attached to the booking
      required:
        - user_id
        - user_name
        - item_id
        - item_name
        - item_group_id
        - item_group_name
        - note
    AreaPresenceResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: presence
            attributes:
              $ref: '#/components/schemas/AreaPresenceAttributes'
          required:
            - type
            - attributes
    AreaPresenceCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AreaPresenceResource'
      required:
        - data
    UserAttributes:
      type: object
      properties:
        email:
          type: string
          format: email
        display_name:
          type: string
        is_admin:
          type: boolean
        auth_source:
          type: string
          enum:
            - internal
            - entraid
        role:
          type: string
          enum:
            - admin
            - user
        last_login:
          type: string
          format: date-time
          description: Timestamp of last successful login (empty if never logged in)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - email
        - display_name
        - is_admin
        - auth_source
        - role
    UserResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: users
            attributes:
              $ref: '#/components/schemas/UserAttributes'
          required:
            - type
            - attributes
    UserSingleResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/UserResource'
      required:
        - data
    UserCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserResource'
      required:
        - data
    CreateUserRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            type:
              type: string
              const: users
            attributes:
              type: object
              properties:
                email:
                  type: string
                  format: email
                display_name:
                  type: string
                password:
                  type: string
                  minLength: 14
                is_admin:
                  type: boolean
              required:
                - email
                - display_name
                - password
          required:
            - type
            - attributes
      required:
        - data
    UpdateUserRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            attributes:
              type: object
              properties:
                email:
                  type: string
                  format: email
                display_name:
                  type: string
                is_admin:
                  type: boolean
                password:
                  type: string
                  minLength: 14
                  description: Admin password reset (local users only)
          required:
            - attributes
      required:
        - data
    UpdateBookingRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            type:
              type: string
              const: bookings
            id:
              type: string
            attributes:
              type: object
              properties:
                note:
                  type: string
                  maxLength: 500
                  description: Free-text note (max 500 characters)
              required:
                - note
          required:
            - type
            - id
            - attributes
      required:
        - data
    ChangePasswordRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            attributes:
              type: object
              properties:
                current_password:
                  type: string
                new_password:
                  type: string
                  minLength: 14
              required:
                - current_password
                - new_password
          required:
            - attributes
      required:
        - data
    DayAvailability:
      type: object
      properties:
        date:
          type: string
          format: date
        weekday:
          type: string
          description: Two-letter weekday abbreviation (MO, TU, WE, TH, FR)
          enum:
            - MO
            - TU
            - WE
            - TH
            - FR
        total:
          type: integer
          description: Total number of items in the group
        available:
          type: integer
          description: Number of items available (not booked) on this day
      required:
        - date
        - weekday
        - total
        - available
    ItemGroupAvailabilityAttributes:
      type: object
      properties:
        item_group_id:
          type: string
        item_group_name:
          type: string
        days:
          type: array
          items:
            $ref: '#/components/schemas/DayAvailability'
      required:
        - item_group_id
        - item_group_name
        - days
    ItemGroupAvailabilityResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: item-group-availability
            attributes:
              $ref: '#/components/schemas/ItemGroupAvailabilityAttributes'
          required:
            - type
            - attributes
    ItemGroupAvailabilityCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/ItemGroupAvailabilityResource'
      required:
        - data
