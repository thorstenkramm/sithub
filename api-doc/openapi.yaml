openapi: 3.1.0
info:
  title: SitHub API
  version: 0.1.0
  license:
    name: Proprietary
    url: https://example.com/license
servers:
  - url: /api/v1
security:
  - cookieAuth: []
paths:
  /ping:
    $ref: ./endpoints/ping.yaml
  /areas:
    $ref: ./endpoints/areas.yaml
  /areas/{area_id}/rooms:
    $ref: ./endpoints/rooms.yaml
  /areas/{area_id}/presence:
    $ref: ./endpoints/area-presence.yaml
  /rooms/{room_id}/desks:
    $ref: ./endpoints/desks.yaml
  /rooms/{room_id}/bookings:
    $ref: ./endpoints/room-bookings.yaml
  /bookings:
    $ref: ./endpoints/bookings.yaml
  /bookings/{booking_id}:
    $ref: ./endpoints/booking.yaml
  /me:
    $ref: ./endpoints/me.yaml
  /auth/login:
    $ref: ./endpoints/auth-login.yaml
  /auth/logout:
    $ref: ./endpoints/auth-logout.yaml
  /users:
    $ref: ./endpoints/users.yaml
  /users/{user_id}:
    $ref: ./endpoints/user.yaml
  /presence:
    $ref: ./endpoints/presence.yaml
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: sithub_user
  schemas:
    ErrorResponse:
      type: object
      properties:
        errors:
          type: array
          items:
            $ref: '#/components/schemas/ErrorObject'
      required:
        - errors
    ErrorObject:
      type: object
      properties:
        status:
          type: string
        title:
          type: string
        detail:
          type: string
        code:
          type: string
    Resource:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
        attributes:
          type: object
    SingleResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/Resource'
      required:
        - data
    CollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Resource'
      required:
        - data
    AreaAttributes:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        floor_plan:
          type: string
      required:
        - name
    AreaResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: areas
            attributes:
              $ref: '#/components/schemas/AreaAttributes'
          required:
            - type
            - attributes
    AreaCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AreaResource'
      required:
        - data
    RoomAttributes:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        floor_plan:
          type: string
      required:
        - name
    RoomResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: rooms
            attributes:
              $ref: '#/components/schemas/RoomAttributes'
          required:
            - type
            - attributes
    RoomCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/RoomResource'
      required:
        - data
    DeskAttributes:
      type: object
      properties:
        name:
          type: string
        equipment:
          type: array
          items:
            type: string
        availability:
          type: string
          enum:
            - available
            - occupied
        warning:
          type: string
        booking_id:
          type: string
          description: Booking ID (admin only, present when occupied)
        booker_name:
          type: string
          description: Name of user who booked (admin only, present when occupied)
      required:
        - name
        - equipment
        - availability
    DeskResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: desks
            attributes:
              $ref: '#/components/schemas/DeskAttributes'
          required:
            - type
            - attributes
    DeskCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/DeskResource'
      required:
        - data
    CreateBookingRequestAttributes:
      type: object
      properties:
        desk_id:
          type: string
          description: ID of the desk to book
        booking_date:
          type: string
          format: date
          description: Date to book the desk (YYYY-MM-DD)
        for_user_id:
          type: string
          description: >
            Optional. ID of another user to book on behalf of.
            If provided, for_user_name is also required.
        for_user_name:
          type: string
          description: >
            Optional. Name of the user to book on behalf of.
            Required if for_user_id is provided.
      required:
        - desk_id
        - booking_date
    CreateBookingRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            type:
              type: string
              const: bookings
            attributes:
              $ref: '#/components/schemas/CreateBookingRequestAttributes'
          required:
            - type
            - attributes
      required:
        - data
    BookingAttributes:
      type: object
      properties:
        desk_id:
          type: string
        user_id:
          type: string
        booking_date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
      required:
        - desk_id
        - user_id
        - booking_date
        - created_at
    BookingResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: bookings
            attributes:
              $ref: '#/components/schemas/BookingAttributes'
          required:
            - type
            - attributes
    BookingSingleResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/BookingResource'
      required:
        - data
    MyBookingAttributes:
      type: object
      properties:
        desk_id:
          type: string
        desk_name:
          type: string
        room_id:
          type: string
        room_name:
          type: string
        area_id:
          type: string
        area_name:
          type: string
        booking_date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
        booked_by_user_id:
          type: string
          description: ID of the user who made the booking (empty if self-booked)
        booked_by_user_name:
          type: string
          description: Name of the user who made the booking (empty if self-booked)
        booked_for_me:
          type: boolean
          description: >
            True if this booking was made on behalf of the current user
            by someone else. False for self-bookings or bookings the
            current user made for others.
      required:
        - desk_id
        - desk_name
        - room_id
        - room_name
        - area_id
        - area_name
        - booking_date
        - created_at
        - booked_by_user_id
        - booked_by_user_name
        - booked_for_me
    MyBookingResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: bookings
            attributes:
              $ref: '#/components/schemas/MyBookingAttributes'
          required:
            - type
            - attributes
    MyBookingsCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/MyBookingResource'
      required:
        - data
    RoomBookingAttributes:
      type: object
      properties:
        desk_id:
          type: string
        desk_name:
          type: string
        user_id:
          type: string
        user_name:
          type: string
        booking_date:
          type: string
          format: date
      required:
        - desk_id
        - desk_name
        - user_id
        - user_name
        - booking_date
    RoomBookingResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: bookings
            attributes:
              $ref: '#/components/schemas/RoomBookingAttributes'
          required:
            - type
            - attributes
    RoomBookingsCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/RoomBookingResource'
      required:
        - data
    AreaPresenceAttributes:
      type: object
      properties:
        user_id:
          type: string
        user_name:
          type: string
        desk_id:
          type: string
        desk_name:
          type: string
        room_id:
          type: string
        room_name:
          type: string
      required:
        - user_id
        - user_name
        - desk_id
        - desk_name
        - room_id
        - room_name
    AreaPresenceResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: presence
            attributes:
              $ref: '#/components/schemas/AreaPresenceAttributes'
          required:
            - type
            - attributes
    AreaPresenceCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AreaPresenceResource'
      required:
        - data
    UserAttributes:
      type: object
      properties:
        email:
          type: string
          format: email
        display_name:
          type: string
        is_admin:
          type: boolean
        auth_source:
          type: string
          enum:
            - internal
            - entraid
        role:
          type: string
          enum:
            - admin
            - user
        last_login:
          type: string
          format: date-time
          description: Timestamp of last successful login (empty if never logged in)
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
        - email
        - display_name
        - is_admin
        - auth_source
        - role
    UserResource:
      allOf:
        - $ref: '#/components/schemas/Resource'
        - type: object
          properties:
            type:
              const: users
            attributes:
              $ref: '#/components/schemas/UserAttributes'
          required:
            - type
            - attributes
    UserSingleResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/UserResource'
      required:
        - data
    UserCollectionResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserResource'
      required:
        - data
    CreateUserRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            type:
              type: string
              const: users
            attributes:
              type: object
              properties:
                email:
                  type: string
                  format: email
                display_name:
                  type: string
                password:
                  type: string
                  minLength: 14
                is_admin:
                  type: boolean
              required:
                - email
                - display_name
                - password
          required:
            - type
            - attributes
      required:
        - data
    UpdateUserRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            attributes:
              type: object
              properties:
                email:
                  type: string
                  format: email
                display_name:
                  type: string
                is_admin:
                  type: boolean
                password:
                  type: string
                  minLength: 14
                  description: Admin password reset (local users only)
          required:
            - attributes
      required:
        - data
    ChangePasswordRequest:
      type: object
      properties:
        data:
          type: object
          properties:
            attributes:
              type: object
              properties:
                current_password:
                  type: string
                new_password:
                  type: string
                  minLength: 14
              required:
                - current_password
                - new_password
          required:
            - attributes
      required:
        - data
